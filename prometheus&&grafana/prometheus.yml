# Global configuration
global:
  # Scrape targets every 15 seconds
  scrape_interval: 15s
  
  # Evaluate alert rules every 15 seconds  
  evaluation_interval: 15s
  
  # Attach labels to all metrics
  external_labels:
    monitor: 'monitoring'
    environment: 'homelab'

# Rule files - Define alert conditions
rule_files:
  - "alert_rules.yml"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

# Scrape configurations - Define targets to monitor
scrape_configs:
  # Monitor Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 15s
    metrics_path: '/metrics'

  # Monitor Node Exporter on monitoring VM
  - job_name: 'monitoring-node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 15s
    metrics_path: '/metrics'

  # Monitor VPN VM - Node Exporter
  - job_name: 'vpn-node'
    static_configs:
      - targets: ['192.168.1.210:9100']
    scrape_interval: 15s
    metrics_path: '/metrics'
    # Optional: Add labels
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: '192.168.1.210:9100'

  # Monitor Alertmanager
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['alertmanager:9093']
    scrape_interval: 15s

  # Monitor Grafana
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    scrape_interval: 15s