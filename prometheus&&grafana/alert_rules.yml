groups:
  # Infrastructure alerts
  - name: infrastructure.rules
    rules:
      # Alert when target is down
      - alert: InstanceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
          service: infrastructure
        annotations:
          summary: "ðŸ”´ **CRITICAL** - Server Down: {{ $labels.instance }}"
          description: |
            **ðŸš¨ SYSTEM OUTAGE DETECTED ðŸš¨**
            
            **ðŸ“ Instance:** `{{ $labels.instance }}`
            **ðŸ·ï¸ Job:** `{{ $labels.job }}`
            **â° Duration:** More than 1 minute
            **ðŸ”¥ Severity:** Critical
            
            **ðŸ“Š Status:** Server is completely unreachable
            **ðŸ”§ Action Required:** Immediate investigation needed
            
            **ðŸ•’ Alert Time:** {{ $labels.alertname }} at {{ .StartsAt.Format "2006-01-02 15:04:05" }}

      # Alert when VPN service might be down
      - alert: VPNNodeDown
        expr: up{job="vpn-node"} == 0
        for: 2m
        labels:
          severity: critical
          service: vpn
        annotations:
          summary: "ðŸ”´ **CRITICAL** - VPN Server Down: {{ $labels.instance }}"
          description: |
            **ðŸš¨ VPN SERVICE OUTAGE ðŸš¨**
            
            **ðŸŒ VPN Server:** `{{ $labels.instance }}`
            **â° Duration:** More than 2 minutes
            **ðŸ”¥ Severity:** Critical
            
            **ðŸ“Š Impact:** 
            â€¢ VPN connections may be dropped
            â€¢ Remote access unavailable
            â€¢ Network routing affected
            
            **ðŸ”§ Immediate Actions:**
            1. Check VPN server status
            2. Verify network connectivity
            3. Restart VPN service if needed
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}

  # Resource usage alerts  
  - name: resource.rules
    rules:
      # High CPU usage
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "âš ï¸ **WARNING** - High CPU Usage: {{ $labels.instance }}"
          description: |
            **ðŸ“ˆ HIGH RESOURCE USAGE DETECTED**
            
            **ðŸ’» Server:** `{{ $labels.instance }}`
            **ðŸ“Š CPU Usage:** > 80% for 5+ minutes
            **ðŸ”¥ Severity:** Warning
            
            **ðŸ’¡ Possible Causes:**
            â€¢ Heavy processes running
            â€¢ Resource-intensive applications
            â€¢ System under high load
            
            **ðŸ”§ Recommended Actions:**
            1. Check running processes: `top` or `htop`
            2. Identify resource-heavy applications
            3. Consider scaling or optimization
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}

      # High memory usage
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "âš ï¸ **WARNING** - High Memory Usage: {{ $labels.instance }}"
          description: |
            **ðŸ§  HIGH MEMORY USAGE DETECTED**
            
            **ðŸ’» Server:** `{{ $labels.instance }}`
            **ðŸ“Š Memory Usage:** > 85% for 5+ minutes
            **ðŸ”¥ Severity:** Warning
            
            **ðŸ’¡ Possible Causes:**
            â€¢ Memory leaks in applications
            â€¢ Too many running processes
            â€¢ Insufficient RAM for workload
            
            **ðŸ”§ Recommended Actions:**
            1. Check memory usage: `free -h`
            2. Identify memory-heavy processes: `ps aux --sort=-%mem`
            3. Restart problematic services if needed
            4. Consider adding more RAM
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}

      # Disk space usage
      - alert: DiskSpaceLow
        expr: node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"} * 100 < 15
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "âš ï¸ **WARNING** - Low Disk Space: {{ $labels.instance }}"
          description: |
            **ðŸ’¾ LOW DISK SPACE WARNING**
            
            **ðŸ’» Server:** `{{ $labels.instance }}`
            **ðŸ“ Filesystem:** `{{ $labels.mountpoint }}`
            **ðŸ“Š Available Space:** < 15%
            **ðŸ”¥ Severity:** Warning
            
            **ðŸ’¡ Impact:**
            â€¢ System performance may degrade
            â€¢ Applications may fail to write files
            â€¢ Log rotation may be affected
            
            **ðŸ”§ Recommended Actions:**
            1. Check disk usage: `df -h`
            2. Clean up temporary files
            3. Archive or delete old logs
            4. Consider expanding storage
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}

      # Critical disk space
      - alert: DiskSpaceCritical
        expr: node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"} * 100 < 5
        for: 2m
        labels:
          severity: critical
          service: system
        annotations:
          summary: "ðŸ”´ **CRITICAL** - Disk Space Almost Full: {{ $labels.instance }}"
          description: |
            **ðŸš¨ CRITICAL DISK SPACE ALERT ðŸš¨**
            
            **ðŸ’» Server:** `{{ $labels.instance }}`
            **ðŸ“ Filesystem:** `{{ $labels.mountpoint }}`
            **ðŸ“Š Available Space:** < 5% (CRITICAL!)
            **ðŸ”¥ Severity:** Critical
            
            **ðŸ’¥ IMMEDIATE IMPACT:**
            â€¢ System may become unresponsive
            â€¢ Applications will fail
            â€¢ Data loss possible
            â€¢ Services may crash
            
            **ðŸš¨ URGENT ACTIONS REQUIRED:**
            1. **IMMEDIATELY** free up space
            2. Delete unnecessary files: `du -h --max-depth=1 /`
            3. Stop non-essential services
            4. Clear logs: `journalctl --vacuum-time=1d`
            5. Contact system administrator
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}

  # Network alerts
  - name: network.rules
    rules:
      # High network traffic
      - alert: HighNetworkTraffic
        expr: rate(node_network_receive_bytes_total[5m]) + rate(node_network_transmit_bytes_total[5m]) > 100 * 1024 * 1024  # 100MB/s
        for: 10m
        labels:
          severity: warning
          service: network
        annotations:
          summary: "âš ï¸ **WARNING** - High Network Traffic: {{ $labels.instance }}"
          description: |
            **ðŸŒ HIGH NETWORK TRAFFIC DETECTED**
            
            **ðŸ’» Server:** `{{ $labels.instance }}`
            **ðŸ“Š Traffic Rate:** > 100 MB/s for 10+ minutes
            **ðŸ”¥ Severity:** Warning
            
            **ðŸ’¡ Possible Causes:**
            â€¢ Large file transfers
            â€¢ DDoS attack
            â€¢ Backup operations
            â€¢ Heavy application traffic
            
            **ðŸ“ˆ Monitoring Suggestions:**
            1. Check network interfaces: `iftop` or `nload`
            2. Monitor active connections: `netstat -i`
            3. Identify high-traffic processes
            4. Verify if traffic is legitimate
            
            **ðŸ”§ Actions if Needed:**
            â€¢ Implement traffic shaping
            â€¢ Check for security threats
            â€¢ Scale network resources
            
            **ðŸ•’ Alert Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
