# DO NOT DISABLE!
# If you change this first entry you will need to make sure that the
# database superuser can access the database using some other method.
# Noninteractive access to all databases is required during automatic
# maintenance (custom daily cronjobs, replication, and similar tasks).
local   all             postgres                                peer

# ==============================================================================
# DATABASE: smap - 4 USER LEVELS SECURITY CONFIGURATION
# ==============================================================================
# Rule priority: First match wins! Order matters!
# ==============================================================================

# -------------------------------
# 1. USER: smap_owner (Owner)
# -------------------------------
# Chỉ cho phép kết nối từ localhost và các subnet nội bộ được phép (192.168.1.0/24, 172.16.21.0/24)
local   smap           smap_owner                             md5
host    smap           smap_owner     127.0.0.1/32            md5
host    smap           smap_owner     ::1/128                 md5
host    smap           smap_owner     192.168.1.0/24          md5
host    smap           smap_owner     172.16.21.0/24          md5
# Từ chối owner kết nối từ mạng ngoài
host    smap           smap_owner     0.0.0.0/0               reject

# -------------------------------
# 2. USER: smap_api (Production API)
# -------------------------------
# Cho phép kết nối vào database smap từ localhost, 192.168.1.0/24 và 172.16.21.0/24 (có thể bổ sung subnet khác nếu cần)
local   smap           smap_api                               md5
host    smap           smap_api       127.0.0.1/32            md5
host    smap           smap_api       ::1/128                 md5
host    smap           smap_api       192.168.1.0/24          md5
host    smap           smap_api       172.16.21.0/24          md5
host    smap           smap_api       0.0.0.0/0               md5

# -------------------------------
# 3. USER: smap_dev (Developers)
# -------------------------------
# Cho phép kết nối vào database smap từ localhost, 192.168.1.0/24 và 172.16.21.0/24
local   smap           smap_dev                               md5
host    smap           smap_dev       127.0.0.1/32            md5
host    smap           smap_dev       ::1/128                 md5
host    smap           smap_dev       192.168.1.0/24          md5
host    smap           smap_dev       172.16.21.0/24          md5
host    smap           smap_dev       0.0.0.0/0               md5

# -------------------------------
# 4. USER: smap_readonly (Analytics)
# -------------------------------
# Cho phép kết nối vào database smap từ localhost, 192.168.1.0/24 và 172.16.21.0/24
local   smap           smap_readonly                          md5
host    smap           smap_readonly  127.0.0.1/32            md5
host    smap           smap_readonly  ::1/128                 md5
host    smap           smap_readonly  192.168.1.0/24          md5
host    smap           smap_readonly  172.16.21.0/24          md5
host    smap           smap_readonly  0.0.0.0/0               md5

# ==============================================================================
# DATABASE: kanban - 4 USER LEVELS SECURITY CONFIGURATION
# ==============================================================================
# Rule priority: First match wins! Order matters!
# ==============================================================================

# -------------------------------
# 1. USER: kanban_owner (Owner)
# -------------------------------
# Chỉ cho phép kết nối từ localhost và các subnet nội bộ được phép (192.168.1.0/24, 172.16.21.0/24)
local   kanban           kanban_owner                             md5
host    kanban           kanban_owner     127.0.0.1/32            md5
host    kanban           kanban_owner     ::1/128                 md5
host    kanban           kanban_owner     192.168.1.0/24          md5
host    kanban           kanban_owner     172.16.21.0/24          md5
# Từ chối owner kết nối từ mạng ngoài
host    kanban           kanban_owner     0.0.0.0/0               reject

# -------------------------------
# 2. USER: kanban_api (Production API)
# -------------------------------
# Cho phép kết nối vào database kanban từ localhost, 192.168.1.0/24 và 172.16.21.0/24 (có thể bổ sung subnet khác nếu cần)
local   kanban           kanban_api                               md5
host    kanban           kanban_api       127.0.0.1/32            md5
host    kanban           kanban_api       ::1/128                 md5
host    kanban           kanban_api       192.168.1.0/24          md5
host    kanban           kanban_api       172.16.21.0/24          md5
host    kanban           kanban_api       0.0.0.0/0               md5

# -------------------------------
# 3. USER: kanban_dev (Developers)
# -------------------------------
# Cho phép kết nối vào database kanban từ localhost, 192.168.1.0/24 và 172.16.21.0/24
local   kanban           kanban_dev                               md5
host    kanban           kanban_dev       127.0.0.1/32            md5
host    kanban           kanban_dev       ::1/128                 md5
host    kanban           kanban_dev       192.168.1.0/24          md5
host    kanban           kanban_dev       172.16.21.0/24          md5
host    kanban           kanban_dev       0.0.0.0/0               md5

# -------------------------------
# 4. USER: kanban_readonly (Analytics)
# -------------------------------
# Cho phép kết nối vào database kanban từ localhost, 192.168.1.0/24 và 172.16.21.0/24
local   kanban           kanban_readonly                          md5
host    kanban           kanban_readonly  127.0.0.1/32            md5
host    kanban           kanban_readonly  ::1/128                 md5
host    kanban           kanban_readonly  192.168.1.0/24          md5
host    kanban           kanban_readonly  172.16.21.0/24          md5
host    kanban           kanban_readonly  0.0.0.0/0               md5

# ==============================================================================
# SECURITY: TỪ CHỐI tất cả smap users kết nối vào database KHÁC
# ==============================================================================
local   all             smap_owner                             reject
local   all             smap_api                               reject
local   all             smap_dev                               reject
local   all             smap_readonly                          reject
host    all             smap_owner     0.0.0.0/0               reject
host    all             smap_api       0.0.0.0/0               reject
host    all             smap_dev       0.0.0.0/0               reject
host    all             smap_readonly  0.0.0.0/0               reject

# ==============================================================================
# SECURITY: TỪ CHỐI tất cả kanban users kết nối vào database KHÁC
# ==============================================================================
local   all             kanban_owner                             reject
local   all             kanban_api                               reject
local   all             kanban_dev                               reject
local   all             kanban_readonly                          reject
host    all             kanban_owner     0.0.0.0/0               reject
host    all             kanban_api       0.0.0.0/0               reject
host    all             kanban_dev       0.0.0.0/0               reject
host    all             kanban_readonly  0.0.0.0/0               reject

# ==============================================================================
# SUPERUSER: postgres (Giữ nguyên)
# ==============================================================================
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             postgres        ::1/128                 scram-sha-256

# ==============================================================================
# OTHER USERS (Giữ nguyên các rules cũ nếu có)
# ==============================================================================
# Local connections
local   all             all                                     peer
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# Replication connections
local   replication     all                                     peer
host    replication     all             127.0.0.1/32            scram-sha-256
host    replication     all             ::1/128                 scram-sha-256

# Remote connections (use specific IP range in production instead of 0.0.0.0/0)
host    all             all             0.0.0.0/0               md5
